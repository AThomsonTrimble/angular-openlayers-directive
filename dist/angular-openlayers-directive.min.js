/**!
 * The MIT License
 *
 * Copyright (c) 2013 the angular-leaflet-directive Team, http://tombatossals.github.io/angular-leaflet-directive
 *
 * Permission is hereby granted, free of charge, to any person obtaining a copy
 * of this software and associated documentation files (the "Software"), to deal
 * in the Software without restriction, including without limitation the rights
 * to use, copy, modify, merge, publish, distribute, sublicense, and/or sell
 * copies of the Software, and to permit persons to whom the Software is
 * furnished to do so, subject to the following conditions:
 *
 * The above copyright notice and this permission notice shall be included in
 * all copies or substantial portions of the Software.
 *
 * THE SOFTWARE IS PROVIDED "AS IS", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR
 * IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY,
 * FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE
 * AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER
 * LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM,
 * OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN
 * THE SOFTWARE.
 *
 * angular-google-maps
 * https://github.com/tombatossals/angular-leaflet-directive
 *
 * @authors https://github.com/tombatossals/angular-leaflet-directive/graphs/contributors
 */

/*! angular-openlayers-directive 30-11-2013 */
!function(){"use strict";angular.module("openlayers-directive",[]).directive("openlayers",["$log","$q","openlayersHelpers","openlayersMapDefaults","openlayersData",function(a,b,c,d,e){var f;return{restrict:"EA",replace:!0,scope:{center:"=center",defaults:"=defaults"},template:'<div class="angular-openlayers-map"></div>',controller:["$scope",function(a){f=b.defer(),this.getMap=function(){return f.promise},this.getOpenlayersScope=function(){return a}}],link:function(a,b,g){var h=c.isDefined;d.setDefaults(a.defaults,g.id),h(g.width)&&(isNaN(g.width)?b.css("width",g.width):b.css("width",g.width+"px")),h(g.height)&&(isNaN(g.height)?b.css("height",g.height):b.css("height",g.height+"px"));var i=new OpenLayers.Map;if(f.resolve(i),!h(g.tiles)&&!h(g.layers)){var j=new OpenLayers.Layer.OSM;i.addLayer(j),e.setTiles(j)}i.render(b[0]),h(g.center)||i.zoomToMaxExtent(),e.setMap(i,g.id)}}}]),angular.module("openlayers-directive").service("openlayersData",["$log","$q","openlayersHelpers",function(a,b,c){var d=c.getDefer,e=c.getUnresolvedDefer,f=c.setResolvedDefer,g={},h={},i={},j={},k={},l={};this.setMap=function(a,b){var c=e(g,b);c.resolve(a),f(g,b)},this.getMap=function(a){var b=d(g,a);return b.promise},this.getPaths=function(a){var b=d(j,a);return b.promise},this.setPaths=function(a,b){var c=e(j,b);c.resolve(a),f(j,b)},this.getMarkers=function(a){var b=d(k,a);return b.promise},this.setMarkers=function(a,b){var c=e(k,b);c.resolve(a),f(k,b)},this.getLayers=function(a){var b=d(i,a);return b.promise},this.setLayers=function(a,b){var c=e(i,b);c.resolve(a),f(i,b)},this.setTiles=function(a,b){var c=e(h,b);c.resolve(a),f(h,b)},this.getTiles=function(a){var b=d(h,a);return b.promise},this.setGeoJSON=function(a,b){var c=e(l,b);c.resolve(a),f(l,b)},this.getGeoJSON=function(a){var b=d(l,a);return b.promise}}]),angular.module("openlayers-directive").factory("openlayersMapDefaults",["$q","openlayersHelpers",function(a,b){function c(){return{keyboard:!0,dragging:!0,doubleClickZoom:!0,scrollWheelZoom:!0,zoomControl:!0,attributionControl:!0,zoomsliderControl:!1,zoomControlPosition:"topleft",controlLayersPosition:"topright",tileLayer:"http://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png",tileLayerOptions:{attribution:'&copy; <a href="http://www.openstreetmap.org/copyright">OpenStreetMap</a> contributors'},icon:{url:"http://cdn.leafletjs.com/leaflet-0.6.4/images/marker-icon.png",retinaUrl:"http://cdn.leafletjs.com/leaflet-0.6.4/images/marker-icon-2x.png",size:[25,41],anchor:[12,40],labelAnchor:[10,-20],popup:[0,-40],shadow:{url:"http://cdn.leafletjs.com/leaflet-0.6.4/images/marker-shadow.png",retinaUrl:"http://cdn.leafletjs.com/leaflet-0.6.4/images/marker-shadow.png",size:[41,41],anchor:[12,40]}},path:{weight:10,opacity:1,color:"#0000ff"}}}var d=b.isDefined,e=b.getDefer,f=b.getUnresolvedDefer,g={};return{getDefaults:function(a){var b=e(g,a);return b.promise},setDefaults:function(a,b){var e=c();d(a)&&(e.doubleClickZoom=d(a.doubleClickZoom)?a.doubleClickZoom:e.doubleClickZoom,e.scrollWheelZoom=d(a.scrollWheelZoom)?a.scrollWheelZoom:e.doubleClickZoom,e.zoomControl=d(a.zoomControl)?a.zoomControl:e.zoomControl,e.attributionControl=d(a.attributionControl)?a.attributionControl:e.attributionControl,e.tileLayer=d(a.tileLayer)?a.tileLayer:e.tileLayer,e.zoomControlPosition=d(a.zoomControlPosition)?a.zoomControlPosition:e.zoomControlPosition,e.keyboard=d(a.keyboard)?a.keyboard:e.keyboard,e.dragging=d(a.dragging)?a.dragging:e.dragging,e.controlLayersPosition=d(a.controlLayersPosition)?a.controlLayersPosition:e.controlLayersPosition,d(a.tileLayerOptions)&&angular.copy(a.tileLayerOptions,e.tileLayerOptions),d(a.maxZoom)&&(e.maxZoom=a.maxZoom),d(a.minZoom)&&(e.minZoom=a.minZoom));var h=f(g,b);return h.resolve(e),e}}}]),angular.module("openlayers-directive").factory("openlayersHelpers",["$q","$log",function(a,b){function c(a,c){var d,e;if(angular.isDefined(c))d=c;else if(1===Object.keys(a).length)for(e in a)a.hasOwnProperty(e)&&(d=e);else 0===Object.keys(a).length?d="main":b.error("[AngularJS - Openlayers] - You have more than 1 map on the DOM, you must provide the map ID to the openlayersData.getXXX call");return d}function d(b,d){var e,f=c(b,d);return angular.isDefined(b[f])&&b[f].resolvedDefer!==!0?e=b[f].defer:(e=a.defer(),b[f]={defer:e,resolvedDefer:!1}),e}return{isDefined:function(a){return angular.isDefined(a)},isNumber:function(a){return angular.isNumber(a)},isDefinedAndNotNull:function(a){return angular.isDefined(a)&&null!==a},isString:function(a){return angular.isString(a)},isArray:function(a){return angular.isArray(a)},isObject:function(a){return angular.isObject(a)},equals:function(a,b){return angular.equals(a,b)},isValidCenter:function(a){return angular.isDefined(a)&&angular.isNumber(a.lat)&&angular.isNumber(a.lng)&&angular.isNumber(a.zoom)},safeApply:function(a,b){var c=a.$root.$$phase;"$apply"===c||"$digest"===c?a.$eval(b):a.$apply(b)},generateUniqueUID:function(){function a(){return Math.floor(65536*(1+Math.random())).toString(16).substring(1)}return a()+a()+"-"+a()+"-"+a()+"-"+a()+"-"+a()+a()+a()},obtainEffectiveMapId:c,getDefer:function(a,b){var e,f=c(a,b);return e=angular.isDefined(a[f])&&a[f].resolvedDefer!==!1?a[f].defer:d(a,b)},getUnresolvedDefer:d,setResolvedDefer:function(a,b){var d=c(a,b);a[d].resolvedDefer=!0}}}])}();